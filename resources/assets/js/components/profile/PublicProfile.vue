<template>
    <div class="profile">
        <div class="left_column public">
            <div class="profile_image">

                <img class="avatar" :src="'/images/users/' + user.avatar"/>
            </div>
            <div class="line"></div>

            <div class="name">
                <h2>{{ fullName }}</h2>
            </div>

            <div class="position">
                <h3>{{ user.profile.position }}</h3>
            </div>

            <div class="add__friend">
                <a href="javascript:void(0)" v-on:click="addToFriend">
                    <svg width="25px" height="25px" viewBox="0 0 25 25" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                        <path d="M25,4.38208008 C25,1.96577148 23.0341797,0 20.6179199,0 C19.3439941,0 18.1957031,0.546777344 17.3942871,1.4175293 C15.8022461,0.698583984 14.1022949,0.333300781 12.3333496,0.333300781 C5.53271484,0.333300781 0,5.86606445 0,12.6666504 C0,19.4672363 5.53271484,25 12.3333496,25 C19.1339844,25 24.6666992,19.4672852 24.6666992,12.6666504 C24.6666992,10.8976562 24.3014648,9.19775391 23.5824219,7.60566406 C24.4532227,6.80424805 25,5.65600586 25,4.38208008 Z M20.6179199,1.23334961 C22.3541504,1.23334961 23.7666992,2.64589844 23.7666992,4.38212891 C23.7666992,6.11835937 22.3541504,7.5309082 20.6179199,7.5309082 C18.8816895,7.5309082 17.4691406,6.11835937 17.4691406,4.38212891 C17.4691895,2.64584961 18.8816895,1.23334961 20.6179199,1.23334961 Z M12.3333496,23.7666504 C6.21279297,23.7666504 1.23334961,18.787207 1.23334961,12.6666504 C1.23334961,6.54609375 6.21279297,1.56665039 12.3333496,1.56665039 C13.8507813,1.56665039 15.3115234,1.86430664 16.6850586,2.45195312 C16.3979004,3.0347168 16.2358887,3.68974609 16.2358887,4.38212891 C16.2358887,6.7984375 18.2016602,8.76420898 20.6179688,8.76420898 C21.3103516,8.76420898 21.9653809,8.60214844 22.5481445,8.31503906 C23.1356934,9.68847656 23.4333496,11.1491699 23.4333496,12.6666992 C23.4333496,18.787207 18.4539063,23.7666504 12.3333496,23.7666504 Z" id="Shape"></path>
                        <path d="M22.562693,4.11031208 L21.484926,4.11031208 L21.484926,3.03254507 C21.484926,2.67267026 21.1932081,2.38095238 20.8333333,2.38095238 C20.4734585,2.38095238 20.1817406,2.67267026 20.1817406,3.03254507 L20.1817406,4.11031208 L19.1039736,4.11031208 C18.7440988,4.11031208 18.452381,4.40202995 18.452381,4.76190476 C18.452381,5.12172798 18.7440988,5.41349745 19.1039736,5.41349745 L20.1817406,5.41349745 L20.1817406,6.49126446 C20.1817406,6.85113927 20.4734585,7.14285714 20.8333333,7.14285714 C21.1932081,7.14285714 21.484926,6.85113927 21.484926,6.49126446 L21.484926,5.41349745 L22.562693,5.41349745 C22.9225678,5.41349745 23.2142857,5.12177957 23.2142857,4.76190476 C23.2142857,4.40202995 22.9225678,4.11031208 22.562693,4.11031208 Z" id="Shape"></path>
                        <path d="M16.3666445,14.5658464 C16.352543,14.5648252 14.8149341,14.6175374 14.3741509,13.0441468 C14.6615619,12.8298942 14.9278954,12.5654094 15.1651789,12.2518594 C15.674576,11.5788552 16.0068327,10.739934 16.1327992,9.83278849 C16.1688751,9.79101749 16.199121,9.74336257 16.2219923,9.69035862 C16.4402413,9.1832227 16.5509104,8.64180441 16.5509104,8.0812269 C16.5509104,5.92275061 14.8762232,4.16666667 12.8177566,4.16666667 C12.2892751,4.16666667 11.77639,4.28274045 11.2914587,4.5118731 C11.1126241,4.52753115 10.9372775,4.55933351 10.7687574,4.60693981 C9.04389278,5.09326317 8.06750263,7.12268214 8.59224693,9.13085091 C8.6449157,9.33236316 8.77242692,9.71856255 8.87602044,9.85841517 C9.07219539,11.225528 9.72803857,12.3677873 10.6273938,13.0386033 C10.1791861,14.6381068 8.64805489,14.5649224 8.6341029,14.565895 C7.14736889,14.6125287 5.95238095,15.8065277 5.95238095,17.2685613 L5.95238095,19.0350029 C5.95238095,19.6983789 6.50542787,20.2380952 7.18518875,20.2380952 L17.8148113,20.2380952 C18.4945721,20.2380952 19.047619,19.6983789 19.047619,19.0350029 L19.047619,17.2685613 C19.0474696,15.8066736 17.8529799,14.6128691 16.3666445,14.5658464 Z M11.0831256,5.66896383 C11.2058533,5.63434107 11.3359058,5.61382027 11.4696455,5.60783909 C11.5526599,5.60414341 11.6338804,5.58269869 11.7074771,5.5450124 C12.0606618,5.36397232 12.4341765,5.27216365 12.8177067,5.27216365 C14.1756838,5.27216365 15.2931884,6.40265515 15.4077442,7.83813816 C15.1252662,7.66468396 14.791415,7.56392784 14.433696,7.56392784 L11.8707154,7.56392784 C11.7595978,7.56392784 11.6541606,7.52998586 11.5659641,7.46565171 C11.4903742,7.41055679 11.4319752,7.33669165 11.3971949,7.25207985 C11.2925549,6.99732052 11.0340445,6.83772515 10.7528621,6.85518241 C10.470982,6.87263968 10.2337982,7.06359976 10.1624936,7.33051597 C10.0548639,7.73412399 9.8648179,8.11317515 9.60914769,8.44554393 C9.43948152,7.15754804 10.049333,5.9604369 11.0831256,5.66896383 Z M9.99337552,9.67440881 C10.3926017,9.31052943 10.7213704,8.87774491 10.9591024,8.40032038 C11.2292727,8.5766436 11.5425945,8.66937619 11.8707154,8.66937619 L14.433696,8.66937619 C14.7048629,8.66937619 14.9401034,8.82041312 15.0570011,9.04054969 C15.0474839,10.4904751 14.4168041,11.7362137 13.5194918,12.2826892 C13.4909899,12.2960132 13.0816983,12.5786847 12.5022423,12.5786847 C11.2886185,12.578636 10.2216899,11.3223453 9.99337552,9.67440881 Z M14.1743384,14.8319845 C13.6925463,15.1739329 13.1079081,15.363191 12.5022921,15.3631424 C11.8956297,15.3631424 11.3101444,15.1733008 10.8279038,14.8303798 C11.2020663,14.4848816 11.489577,14.0501034 11.6536125,13.5601816 C11.9264237,13.6411463 12.210546,13.6840358 12.5022423,13.6840358 C12.7910983,13.6840358 13.0737756,13.6416812 13.3470353,13.5619322 C13.5115691,14.0519512 13.7996777,14.4866322 14.1743384,14.8319845 Z M17.9147175,19.034857 L17.9147175,19.034857 C17.9147175,19.0887363 17.869822,19.132501 17.8146618,19.132501 L7.18503926,19.132501 C7.12982925,19.132501 7.08498356,19.0887363 7.08498356,19.034857 L7.08498356,17.2684154 C7.08498356,16.386459 7.8202036,15.6689606 8.72394375,15.6689606 C8.73919128,15.6689606 9.27385147,15.6602563 9.82370936,15.4555346 C10.5520032,16.1036416 11.5069671,16.4685908 12.5023419,16.4685908 C13.4970192,16.4685908 14.4515844,16.1039333 15.1797786,15.4565558 C15.7405988,15.6794155 16.2605596,15.6690092 16.2758569,15.6690092 C17.1795473,15.6690092 17.9147673,16.3865076 17.9147673,17.2684641 L17.9147673,19.034857 L17.9147175,19.034857 Z" id="Shape"></path>
                    </svg>

                    <p>Добавить</p>
                </a>
            </div>
            <vue-snotify></vue-snotify>


        </div>

        <div class="right_column public">
            <div class="contact__information">
                <h2>Контактная информация</h2>

                <div class="info">

                    <div class="info__item">
                        <h4 class="public">Email:</h4>

                        <p>{{ user.email }}</p>
                    </div>

                    <div class="info__item">
                        <h4 class="public">Телефон:</h4>

                        <p>{{ user.profile.phone_number }}</p>
                    </div>

                    <div class="info__item">
                        <h4 class="public">Адресс:</h4>

                        <p>{{ user.profile.address }}</p>
                    </div>

                </div>
            </div>

            <div class="about public">
                <h2 class="public">Обо мне</h2>

                <p>{{ user.profile.about }}</p>
            </div>
        </div>
        <div class="modal" id="modal"></div>
    </div>
</template>

<script>
    // import auth from '../auth'
    import Vue from 'vue';
    import izimodal from 'izimodal';
    Vue.use(izimodal);

    export default {
        name: "public-profile",
        data() {
            return {
                // auth: auth
                token: localStorage.getItem('id_token'),
                user: {
                    id: '',
                    first_name: '',
                    last_name: '',
                    email: '',
                    avatar: '/images/loader.gif',
                    profile: {
                        position: '',
                        phone_number: '',
                        address: '',
                        about: '',
                    },
                },
            }
        },
        computed: {
            fullName() {
                return this.user.first_name + ' ' + this.user.last_name
            }
        },
        mounted() {
            this.getUser()
        },
        watch: {
            '$route'(to, from) {
                this.getUser();
            }
        },
        methods: {
            getUser() {
                axios.get('https://localhost:3000/api/user?user=' + this.$route.params.id + '&token=' + this.token)
                    .then(response => {
                        this.user = response.data;
                        this.$bar.finish()
                    })
            },
            addToFriend() {

                axios.post('https://localhost:3000/api/friend/sendRequest?token=' + this.token, {
                    id: this.user.id
                }).then(res => {
                    this.$snotify.success('Заявка на добавление в друзья успешно отправлена', {
                        timeout: 2000,
                        position: 'centerBottom',
                    });
                    console.log(res.data);
                })
            }

        }
    }
</script>